(function(a, c, b) {
    if (typeof define == "function" && define.amd) {
        define(b);
    } else {
        a[c] = b();
    }
})(window, "YyHelper",
function() {
    var b = !!document.body;
    var r = navigator.userAgent;
    var n = /duobao/i.test(r);
    var H = /ios|iphone|ipad|ipod/i.test(r);
    var g = /duobaopro/i.test(r);
    var C = /duobaoperson/i.test(r);
    var z = /android/i.test(r);
    var D = (document.cookie.match(/adapt_version_flag=(.+?)(?=;|$)/) || window.location.search.match(/ter=(.+?)(?=&|$)/) || [])[1];
    var l = window.location.host;
    var I = "m.1.gztest.mail.163.com";
    var e = "tm.1.163.com";
    var F = "1.163.com";
    var j = I == l;
    var q = j || e == l;
    var M = {
        VER: "1.6.6",
        BRIDGE_VER: "2.0.2",
        PREFIX: j ? I: (q ? e: F),
        SUFFIX: ".do",
        NORMAL: "normal",
        NEWS: "news",
        WEIXIN: "weixin",
        YIXIN: "yixin",
        DASHI: "dashi",
        WEIBO: "weibo",
        YOUQIAN: "youqian",
        KAOLA: "kaola",
        OPEN: "open",
        DOWNLOAD: "download",
        GO: "go",
        CLOSE: "close",
        BACK: "back",
        LOGIN: "login",
        WISH_CREATE: "wishCreate",
        DETAIL: "detail",
        CART: "cart",
        ADD_TO_CART: "addToCart",
        MALL_ORDER_LIST: "mallOrderList",
        GO_MAP: {
            home: "",
            share: "",
            index: "",
            cart: "",
            pay: "",
            result: "",
            setting: "",
            detail: "",
            recharge: "",
            userCenter: "",
            userDuobao: "",
            userCharge: "",
            userShare: "",
            userDetail: "",
            userWin: "",
            bonus: "",
            userBonus: "bonus"
        },
        URL_MAP: {
            home: "/index",
            share: "/share/index.html",
            index: "/index",
            cart: "/cart/index",
            pay: "/newpay/order",
            payResult: "/newpay/result",
            recharge: "/cashier/recharge/info",
            rechargeResult: "/cashier/recharge/result",
            user: "/user/index",
            userCenter: "/user/index",
            userDuobao: "/user/duobaoRecord",
            userCharge: "/user/chargeRecord",
            userShare: "/user/share",
            userBonus: "/user/bonus",
            bonus: "/user/bonus",
            userDetail: "/user/detail",
            userWin: "/user/win",
            mallOrderList: "/user/mallrecord",
            login: "/login",
            question: "/question",
            wishCreate: "/wish/setwish",
            wishList: "/wishlist/goods"
        },
        DOWNLOAD_URL: "http://1.163.com/html/app/intro.htm",
        NEWS_LOGIN_URL: "http://1.163.com/one.user/news/index.do?login=true",
        init: E,
        exec: o,
        is: c,
        isApp: u,
        isAndroid: m,
        isIOS: B,
        getAppVer: h,
        isWeixin: p,
        isYixin: L,
        isDashi: i,
        isNormal: y,
        isWeibo: G,
        isNews: A,
        isKaola: v,
        isYouqian: d,
        isIOSPro: J,
        isIOSPerson: K,
        getAdaptVer: t,
        __touch: f,
        __getUrl: w,
        __getDetailUrl: s,
        __listen: k,
        __inject: a,
        __parseCommand: x,
        __inited: false
    };
    if (b) {
        M.init();
    } else {
        M.__listen(window, "load",
        function() {
            M.init();
        });
    }
    return M;
    function c(O) {
        var N = false;
        switch (O.toLowerCase()) {
        case "ios":
            N = !!this.isIOS();
            break;
        case "android":
            N = !!this.isAndroid();
            break;
        default:
            N = this.getAdaptVer() == O;
            break;
        }
        return N;
    }
    function J() {
        return g;
    }
    function K() {
        return C;
    }
    function v() {
        return this.getAdaptVer() == this.KAOLA;
    }
    function d() {
        return this.getAdaptVer() == this.YOUQIAN;
    }
    function p() {
        return this.getAdaptVer() == this.WEIXIN;
    }
    function L() {
        return this.getAdaptVer() == this.YIXIN;
    }
    function i() {
        return this.getAdaptVer() == this.DASHI;
    }
    function A() {
        return this.getAdaptVer() == this.NEWS;
    }
    function G() {
        return this.getAdaptVer() == this.WEIBO;
    }
    function y() {
        var N = this.getAdaptVer();
        return N == this.NORMAL || N === undefined;
    }
    function t() {
        return D;
    }
    function u() {
        return this.isIOS() || this.isAndroid();
    }
    function B() {
        return n && H && !z && this.getAppVer();
    }
    function m() {
        return n && z && this.getAppVer();
    }
    function h() {
        var N = navigator.userAgent;
        return (N.match(/duobao[^/\s] * ?\ / (. + ?)( ? =\ / |\s | $) / i) || [])[1];
    }
    function o(T, R, U) {
        var V = this;
        var Q = window.YyJSBridge;
        var O = this.__parseCommand(T, U);
        var Y = O.invoke;
        var X = O.params;
        var W = U && (typeof U == "function" ? U: U.getAttribute("data-callback"));
        if (this.isApp()) {
            Q && P.call(this);
        } else {
            if (R) {
                S.call(this, R);
            } else {
                N.call(this);
            }
        }
        function N() {
            var Z = "";
            switch (Y) {
            case this.ADD_TO_CART:
                Z = this.__getUrl(this.CART, X);
                break;
            case this.LOGIN:
                if (this.isNews()) {
                    Z = this.NEWS_LOGIN_URL;
                } else {
                    Z = this.__getUrl(Y, {
                        url: encodeURIComponent(window.location.href)
                    });
                }
                break;
            case this.DETAIL:
                Z = this.__getDetailUrl(X);
                break;
            default:
                if (Y in this.URL_MAP) {
                    Z = this.__getUrl(Y, X);
                }
                break;
            }
            S(Z);
        }
        function P() {
            if (R) {
                X.callback = function(ad) {
                    if (ad.code == -1) {
                        S(R);
                    }
                };
            }
            if (W) {
                X.callback = typeof W == "string" ? new Function(W) : W;
            }
            switch (Y) {
            case this.OPEN:
                this.openApp();
                break;
            case this.DOWNLOAD:
                window.location.href = this.DOWNLOAD_URL;
                break;
            case this.ADD_TO_CART:
                var ac = document.createElement("img");
                var aa = [];
                for (var ab in X) {
                    aa.push(encodeURIComponent(ab) + "=" + encodeURIComponent(X[ab]));
                }
                var Z = aa.length ? "?" + aa.join("&") : "";
                ac.onerror = ac.onload = function() {
                    Q.invoke(V.GO, {
                        module: "cart"
                    });
                };
                ac.src = "/cart/index.do" + Z;
                break;
            case this.LOGIN:
                X.callback = X.callback ||
                function() {
                    Q.invoke("refresh");
                };
                Q.invoke(this.LOGIN, X);
                break;
            case this.WISH_CREATE:
                if (this.isAndroid() || (this.isIOS() >= "3.2.0")) {
                    Q.invoke(Y, X);
                } else {
                    if (R) {
                        S(R);
                    } else {
                        delete X.callback;
                        S(this.__getUrl(Y, X));
                    }
                }
                break;
            case this.MALL_ORDER_LIST:
                if (this.isAndroid() || (this.isIOS() >= "4.4.0")) {
                    Q.invoke(Y, X);
                } else {
                    if (R) {
                        S(R);
                    } else {
                        delete X.callback;
                        S(this.__getUrl(Y, X));
                    }
                }
                break;
            default:
                if (Y in this.GO_MAP) {
                    X.module = this.GO_MAP[Y] || Y;
                    Y = this.GO;
                }
                Q.invoke(Y, X);
                break;
            }
        }
        function S(Z) {
            window.location.href = Z;
        }
    }
    function w(S, O) {
        var P = this.URL_MAP[S];
        var R = [];
        var N = "";
        for (var Q in O) {
            R.push(Q + "=" + O[Q]);
        }
        if (R.length) {
            N += "?";
            N += R.join("&");
        }
        if (P) {
            if (/\.\w+$/.test(P)) {
                P = this.PREFIX + P + N;
            } else {
                P = this.PREFIX + P + this.SUFFIX + N;
            }
            return "//" + P;
        } else {
            return S + N;
        }
    }
    function s(N) {
        var R = N.gid;
        var O = N.period;
        delete N.gid;
        delete N.period;
        var Q = [];
        for (var P in N) {
            Q.push(P + "=" + N[P]);
        }
        return "//" + this.PREFIX + "/detail/" + R + (O ? "-" + O: "") + ".html" + (Q.length ? "?" + Q.join("&") : "");
    }
    function E() {
        if (!this.__inited) {
            var N = document.body;
            this.__inject(N, "data-invoke", "data-no-invoke",
            function(Q, P, O) {
                this.exec(Q, P, O);
                return false;
            });
            this.__inited = true;
        }
    }
    function x(T, P) {
        var Q = T.split("?");
        var S = Q[0].replace(/\/$/, "");
        var O = Q[1] || "";
        var R = O.split("&");
        return {
            invoke: S,
            params: N(R)
        };
        function N(Z) {
            var aa = {};
            for (var V = 0,
            U = Z.length; V < U; V++) {
                var X = Z[V].split("=");
                var Y = X[0];
                if (Y) {
                    var ab = X[1];
                    var W = /^\[(.*?)\]$/;
                    if (W.test(ab)) {
                        ab = ab.match(W)[1];
                        ab = P.getAttribute(ab);
                    }
                    aa[Y] = ab;
                }
            }
            return aa;
        }
    }
    function k(N, Q, O) {
        try {
            if (Q == "touch") {
                this.__touch(N, O);
            } else {
                N.addEventListener(Q, O, false);
            }
        } catch(P) {
            N.attachEvent("on" + Q, O);
        }
    }
    function a(O, R, N, Q) {
        var P = this;
        this.__listen(O, "touch",
        function(aa) {
            var ac = aa || window.event;
            var T = ac.srcElement || ac.target;
            var V = "data-injected";
            var ad = "href";
            var ab = "javascript:void(0);";
            var W = /^(?:#+|javascript\:void\(0\);?)$/i;
            do {
                var X = T.getAttribute(R);
                if (X !== null) {
                    var Z = T.getAttribute(ad);
                    var S = T.getAttribute(N);
                    var Y = Z && !W.test(Z) && !T.getAttribute(V);
                    if (Y) {
                        S = S || Z;
                    }
                    var U = Q.call(P, X, S, T) === false;
                    if (Y) {
                        T.setAttribute(N, S);
                        T.setAttribute(ad, ab);
                        T.setAttribute(V, "true");
                    }
                    if (U) {
                        break;
                    }
                }
                T = T.parentNode;
            } while ( T && T !== document . documentElement );
        });
    }
    function f(Q, P) {
        var O, N;
        if (Q) {
            Q.addEventListener("touchstart",
            function(S) {
                var R = S.touches[0];
                O = R.clientX;
                N = R.clientY;
            },
            false);
            Q.addEventListener("touchend",
            function(T) {
                var S = T.changedTouches[0];
                var R = S.clientX;
                var U = S.clientY;
                if (Math.abs(O - R) < 6 && Math.abs(N - U) < 6) {
                    P && P(T, Q);
                    Q = null;
                }
            },
            false);
        }
    }
});